extends ../../layouts/default.pug
include ../../mixins/alert.pug

block main
    +alert-success(5000)
    +alert-error(5000)

    .container.my-5
        .row.justify-content-center
            .col-lg-6
                .card.shadow-sm.border-0
                    .card-header.text-white.py-3(style="background-color: #DB0E0E;")
                        h4.mb-0.d-flex.align-items-center
                            i.fa-solid.fa-key.me-3
                            | Đổi mật khẩu

                    .card-body.p-4
                        form(action="/user/change-password" method="POST")
                            .form-group.mb-3
                                label.form-label.fw-bold(for="currentPassword") 
                                    i.fa-solid.fa-lock.me-2(style="color: #DB0E0E;")
                                    | Mật khẩu hiện tại
                                    span.text-danger *
                                input.form-control(
                                    type="password"
                                    id="currentPassword"
                                    name="currentPassword"
                                    required
                                    placeholder="Nhập mật khẩu hiện tại"
                                )

                            .form-group.mb-3
                                label.form-label.fw-bold(for="newPassword")
                                    i.fa-solid.fa-key.me-2(style="color: #DB0E0E;")
                                    | Mật khẩu mới
                                    span.text-danger *
                                input.form-control(
                                    type="password"
                                    id="newPassword"
                                    name="newPassword"
                                    required
                                    placeholder="Nhập mật khẩu mới (tối thiểu 6 ký tự)"
                                    minlength="6"
                                )

                            .form-group.mb-4
                                label.form-label.fw-bold(for="confirmPassword")
                                    i.fa-solid.fa-check-circle.me-2(style="color: #DB0E0E;")
                                    | Xác nhận mật khẩu mới
                                    span.text-danger *
                                input.form-control(
                                    type="password"
                                    id="confirmPassword"
                                    name="confirmPassword"
                                    required
                                    placeholder="Nhập lại mật khẩu mới"
                                    minlength="6"
                                )

                            .row
                                .col-12
                                    .d-flex.justify-content-between.align-items-center
                                        button.btn.px-4.me-3.text-white(type="submit", style="background-color: #DB0E0E; border-color: #DB0E0E;")
                                            i.fa-solid.fa-save.me-2
                                            | Đổi mật khẩu
                                        a.btn.btn-outline-secondary.px-4(href="/user/info")
                                            i.fa-solid.fa-times.me-2
                                            | Hủy bỏ

                        .row.mt-4
                            .col-12
                                .alert.alert-info.d-flex.align-items-center
                                    i.fa-solid.fa-info-circle.me-2
                                    div
                                        strong Lưu ý:
                                        ul.mb-0.mt-2
                                            li Mật khẩu phải có ít nhất 6 ký tự
                                            li Nên sử dụng kết hợp chữ và số
                                            li Không chia sẻ mật khẩu với người khác

        .row.mt-3
            .col-12.text-center
                a.btn.text-white.px-4(href="/user/info", style="background-color: #6c757d; border-color: #6c757d;")
                    i.fa-solid.fa-arrow-left.me-2
                    | Quay lại thông tin tài khoản

    script.
        // Validation form
        document.querySelector('form').addEventListener('submit', function(e) {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Kiểm tra mật khẩu hiện tại
            if (!currentPassword) {
                e.preventDefault();
                alert('Vui lòng nhập mật khẩu hiện tại!');
                return;
            }

            // Kiểm tra mật khẩu mới
            if (!newPassword) {
                e.preventDefault();
                alert('Vui lòng nhập mật khẩu mới!');
                return;
            }

            if (newPassword.length < 6) {
                e.preventDefault();
                alert('Mật khẩu mới phải có ít nhất 6 ký tự!');
                return;
            }

            // Kiểm tra xác nhận mật khẩu
            if (!confirmPassword) {
                e.preventDefault();
                alert('Vui lòng xác nhận mật khẩu mới!');
                return;
            }

            if (newPassword !== confirmPassword) {
                e.preventDefault();
                alert('Xác nhận mật khẩu không khớp!');
                return;
            }

            // Kiểm tra mật khẩu mới không giống mật khẩu cũ
            if (currentPassword === newPassword) {
                e.preventDefault();
                alert('Mật khẩu mới phải khác mật khẩu hiện tại!');
                return;
            }
        });

        // Real-time validation
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.value;
            
            if (confirmPassword && newPassword !== confirmPassword) {
                this.setCustomValidity('Mật khẩu không khớp');
            } else {
                this.setCustomValidity('');
            }
        });
