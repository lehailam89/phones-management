extends ../../layouts/default.pug
include ../../mixins/alert.pug
include ../../mixins/select-tree.pug

block main
  if(role.permissions.includes('products_view'))
    +alert-error(4000) 

    div(class="d-flex justify-content-between align-items-center mb-4")
      h1(class="mb-0") Chi tiết sản phẩm
      a(
        href=`${prefixAdmin}/products`
        class="btn btn-outline-secondary"
      ) 
        i(class="fa fa-arrow-left mr-1")
        | Quay lại

    div(class="card")
      div(class="card-header")
        h4(class="card-title mb-0") #{product.title || "Chưa có tiêu đề"}
      
      div(class="card-body")
        div(class="row")
          div(class="col-md-4")
            if (product.thumbnail)
              div(class="mb-3")
                label(class="font-weight-bold") Ảnh đại diện:
                div
                  img(
                    src=product.thumbnail
                    alt=product.title
                    class="img-fluid rounded border"
                    style="max-width: 100%; height: auto;"
                  )
            else
              div(class="mb-3")
                label(class="font-weight-bold") Ảnh đại diện:
                div(class="text-muted") Chưa có ảnh

            if (product.images && product.images.length > 0)
              div(class="mb-3")
                label(class="font-weight-bold") Ảnh mô tả:
                div(class="row")
                  each image in product.images
                    div(class="col-6 col-lg-4 mb-2")
                      img(
                        src=image
                        alt=product.title
                        class="img-fluid rounded border"
                        style="width: 100%; height: 80px; object-fit: cover;"
                      )

          div(class="col-md-8")
            div(class="row")
              div(class="col-sm-6")
                div(class="form-group")
                  label(class="font-weight-bold") Giá bán:
                  div(class="text-primary h5") #{product.price ? product.price.toLocaleString() + "$" : "Chưa có giá"}

              div(class="col-sm-6")
                div(class="form-group")
                  label(class="font-weight-bold") Giảm giá:
                  div(class="text-danger") #{product.discountPercentage || 0}%

              div(class="col-sm-6")
                div(class="form-group")
                  label(class="font-weight-bold") Số lượng tồn:
                  div #{product.stock || 0} sản phẩm

              div(class="col-sm-6")
                div(class="form-group")
                  label(class="font-weight-bold") Vị trí:
                  div #{product.position || "Chưa set"}

              div(class="col-sm-6")
                div(class="form-group")
                  label(class="font-weight-bold") Trạng thái:
                  div
                    if (product.status === "active")
                      span(class="badge badge-success px-2 py-1") Hoạt động
                    else
                      span(class="badge badge-danger px-2 py-1") Dừng hoạt động

              div(class="col-sm-6")
                div(class="form-group")
                  label(class="font-weight-bold") Nổi bật:
                  div
                    if (product.featured == "1")
                      span(class="badge badge-warning px-2 py-1") Có
                    else
                      span(class="badge badge-secondary px-2 py-1") Không

              if (product.product_category_id)
                div(class="col-sm-12")
                  div(class="form-group")
                    label(class="font-weight-bold") Danh mục:
                    div #{categoryName}

            if (product.description)
              div(class="form-group mt-4")
                label(class="font-weight-bold") Mô tả sản phẩm:
                div(class="border rounded p-3 bg-light product-description")
                  | !{product.description}

      div(class="card-footer text-right")
        if(role.permissions.includes('products_edit'))
          a(
            href=`${prefixAdmin}/products/edit/${product.id}`
            class="btn btn-primary mr-2"
          )
            i(class="fa fa-edit mr-1")
            | Chỉnh sửa
        a(
          href=`${prefixAdmin}/products`
          class="btn btn-secondary"
        )
          i(class="fa fa-list mr-1")
          | Danh sách sản phẩm

    style.
      .product-description img {
        max-width: 100% !important;
        height: auto !important;
        object-fit: contain;
        border-radius: 5px;
        margin: 10px 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .product-description {
        overflow-x: auto;
        word-wrap: break-word;
      }
      
      .product-description p {
        margin-bottom: 15px;
        line-height: 1.6;
      }
      
      .product-description * {
        max-width: 100% !important;
      }